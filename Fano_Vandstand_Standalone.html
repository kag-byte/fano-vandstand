<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fan√∏ Vandstand - Live Simulator</title>
    
    <!-- PWA Support -->
    <meta name="theme-color" content="#0066CC">
    <meta name="description" content="Live vandstandsdata og sejladsstatus for Fan√∏ overfart">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230066CC' width='100' height='100'/><text fill='white' font-size='60' x='50' y='70' text-anchor='middle'>üåä</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            --primary: #0066CC;
            --danger: #FF3B30;
            --warning: #FF9500;
            --success: #34C759;
            --text: #1D1D1F;
            --gray: #86868B;
            --bg: #FBFBFD;
            --white: #FFFFFF;
            --border: rgba(0,0,0,0.06);
            
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            --space-3xl: 64px;
            
            --text-xs: 11px;
            --text-sm: 13px;
            --text-base: 15px;
            --text-lg: 17px;
            --text-xl: 21px;
            --text-2xl: 28px;
            --text-3xl: 34px;
            --text-4xl: 48px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', sans-serif;
            font-size: var(--text-base);
            line-height: 1.5;
            color: var(--text);
            background: var(--bg);
        }

        .app {
            max-width: 840px;
            margin: 0 auto;
            padding: var(--space-lg);
        }

        .header {
            text-align: center;
            padding: var(--space-3xl) 0 var(--space-2xl);
            border-bottom: 1px solid var(--border);
            margin-bottom: var(--space-2xl);
        }

        .header h1 {
            font-size: var(--text-4xl);
            font-weight: 700;
            letter-spacing: -0.03em;
            line-height: 1;
            margin-bottom: var(--space-sm);
        }

        .header .subtitle {
            font-size: var(--text-lg);
            color: var(--gray);
            font-weight: 400;
        }

        .meta-bar {
            display: flex;
            justify-content: center;
            gap: var(--space-lg);
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--border);
            font-size: var(--text-sm);
            color: var(--gray);
            flex-wrap: wrap;
        }

        .meta-bar span {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .notice-banner {
            background: linear-gradient(135deg, var(--primary), #0052A3);
            color: var(--white);
            padding: var(--space-md) var(--space-lg);
            border-radius: 12px;
            margin-bottom: var(--space-xl);
            text-align: center;
            font-size: var(--text-sm);
        }

        .notice-banner a {
            color: var(--white);
            font-weight: 600;
        }

        .live-data-card {
            background: var(--white);
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: var(--space-xl);
            overflow: hidden;
        }

        .live-data-header {
            padding: var(--space-md) var(--space-lg);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            background: var(--primary);
            color: var(--white);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .live-data-content {
            padding: var(--space-xl);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-xl);
        }

        .current-level {
            text-align: center;
        }

        .current-level .label {
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray);
            margin-bottom: var(--space-sm);
        }

        .current-level .value {
            font-size: var(--text-4xl);
            font-weight: 700;
            font-family: 'SF Mono', 'Monaco', monospace;
            letter-spacing: -0.02em;
        }

        .current-level .value.normal { color: var(--text); }
        .current-level .value.warning { color: var(--warning); }
        .current-level .value.danger { color: var(--danger); }
        .current-level .value.low { color: var(--primary); }

        .current-level .time {
            font-size: var(--text-sm);
            color: var(--gray);
            margin-top: var(--space-sm);
        }

        .current-level .trend {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            margin-top: var(--space-sm);
            padding: var(--space-xs) var(--space-sm);
            background: var(--bg);
            border-radius: 20px;
            font-size: var(--text-sm);
        }

        .trend.rising { color: var(--danger); }
        .trend.falling { color: var(--primary); }
        .trend.stable { color: var(--gray); }

        .status-alert {
            background: var(--white);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .status-alert.danger {
            background: rgba(255, 59, 48, 0.05);
            border-color: rgba(255, 59, 48, 0.3);
        }

        .status-alert.warning {
            background: rgba(255, 149, 0, 0.05);
            border-color: rgba(255, 149, 0, 0.3);
        }

        .status-alert.safe {
            background: rgba(52, 199, 89, 0.05);
            border-color: rgba(52, 199, 89, 0.3);
        }

        .status-alert-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .status-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-icon.danger { background: var(--danger); color: var(--white); }
        .status-icon.warning { background: var(--warning); color: var(--white); }
        .status-icon.safe { background: var(--success); color: var(--white); }

        .status-title {
            font-size: var(--text-lg);
            font-weight: 600;
        }

        .status-message {
            font-size: var(--text-base);
            line-height: 1.5;
            color: var(--gray);
        }

        .card {
            background: var(--white);
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: var(--space-md);
            overflow: hidden;
        }

        .card-header {
            padding: var(--space-md) var(--space-lg);
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
        }

        .card-header.danger {
            background: var(--danger);
            color: var(--white);
            border-bottom: none;
        }

        .card-header.primary {
            background: var(--primary);
            color: var(--white);
            border-bottom: none;
        }

        .level-item {
            display: grid;
            grid-template-columns: 100px 1fr;
            align-items: center;
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--border);
            transition: background 0.15s ease;
        }

        .level-item:last-child {
            border-bottom: none;
        }

        .level-item:hover {
            background: var(--bg);
        }

        .level-item.active {
            background: rgba(0, 102, 204, 0.05);
            border-left: 3px solid var(--primary);
        }

        .level-value {
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--gray);
        }

        .level-item.critical .level-value { color: var(--danger); }
        .level-item.warning .level-value { color: var(--warning); }
        .level-item.low .level-value { color: var(--primary); }

        .level-desc {
            font-size: var(--text-base);
            line-height: 1.4;
            color: var(--text);
        }

        .footer {
            text-align: center;
            padding: var(--space-3xl) 0 var(--space-xl);
            font-size: var(--text-xs);
            color: var(--gray);
            line-height: 1.6;
        }

        .footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .quick-actions {
            position: fixed;
            bottom: var(--space-lg);
            right: var(--space-lg);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            z-index: 100;
        }

        .action-btn {
            width: 48px;
            height: 48px;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .action-btn.primary {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            :root {
                --text-4xl: 36px;
                --text-3xl: 28px;
                --text-2xl: 24px;
            }

            .app {
                padding: var(--space-md);
            }

            .header {
                padding: var(--space-2xl) 0 var(--space-xl);
            }

            .live-data-content {
                grid-template-columns: 1fr;
            }

            .level-item {
                grid-template-columns: 80px 1fr;
                padding: var(--space-md);
            }

            .quick-actions {
                bottom: var(--space-md);
                right: var(--space-md);
            }
        }

        @media print {
            .quick-actions, .notice-banner {
                display: none;
            }

            body {
                background: white;
                font-size: 11pt;
            }

            .card {
                break-inside: avoid;
            }
        }

        html {
            scroll-behavior: smooth;
        }

        :focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1>Fan√∏ Vandstand</h1>
            <p class="subtitle">Live simulator med realistisk tidevandsmodel</p>
            <div class="meta-bar">
                <span><span class="status-indicator"></span> Simulator k√∏rer</span>
                <span id="currentDate">-</span>
                <span>Esbjerg Havn</span>
            </div>
        </header>

        <!-- Notice Banner -->
        <div class="notice-banner">
            üìä Dette er en simuleret version baseret p√• typiske tidevandsm√∏nstre for Vadehavet. 
            For live data, se <a href="https://www.dmi.dk/hav/vandstand/" target="_blank">DMI Vandstand</a> eller 
            <a href="https://portesbjerg.dk/havneservice/vejrforhold" target="_blank">Esbjerg Havn</a>
        </div>

        <!-- Status Alert -->
        <div id="statusAlert" class="status-alert safe">
            <div class="status-alert-header">
                <div id="statusIcon" class="status-icon safe">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"></path>
                    </svg>
                </div>
                <div id="statusTitle" class="status-title">Sejlads status</div>
            </div>
            <div id="statusMessage" class="status-message"></div>
        </div>

        <!-- Live Data Card -->
        <div class="live-data-card">
            <div class="live-data-header">
                <span>Simuleret Vandstand ‚Äî Esbjerg Havn</span>
                <span id="updateTime">-</span>
            </div>
            <div class="live-data-content">
                <div class="current-level">
                    <div class="label">Nuv√¶rende niveau</div>
                    <div id="currentValue" class="value normal">-</div>
                    <div id="currentTime" class="time">-</div>
                    <div id="trend" class="trend stable">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14"></path>
                        </svg>
                        <span id="trendText">Beregner...</span>
                    </div>
                </div>
                <div class="current-level">
                    <div class="label">N√¶ste h√∏jvande</div>
                    <div id="nextHighValue" class="value normal">-</div>
                    <div id="nextHighTime" class="time">-</div>
                    <div id="timeToHigh" class="trend stable">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span id="timeToHighText">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- High Water Levels -->
        <div class="card">
            <div class="card-header danger">
                H√∏jvande ‚Äî Kritiske niveauer
            </div>
            <div id="highWaterLevels">
                <div class="level-item critical" data-level="300">
                    <div class="level-value">+300 cm</div>
                    <div class="level-desc">Forpladser i Esbjerg og Nordby under vand</div>
                </div>
                <div class="level-item critical" data-level="290">
                    <div class="level-value">+290 cm</div>
                    <div class="level-desc">Esbjerg Havn lukker typisk for tilk√∏rselsveje</div>
                </div>
                <div class="level-item critical" data-level="285">
                    <div class="level-value">+285 cm</div>
                    <div class="level-desc">Vand p√• frak√∏rselsvej ved den gamle ventesal</div>
                </div>
                <div class="level-item critical" data-level="273">
                    <div class="level-value">+273 cm</div>
                    <div class="level-desc">Vand til kajkanten mellem M/B S√∏nderh√∏ og ventesal</div>
                </div>
                <div class="level-item warning" data-level="240">
                    <div class="level-value">+240 cm</div>
                    <div class="level-desc">Ca. 3 timer f√∏r: vurder rydning af lav P-plads (√òst)</div>
                </div>
                <div class="level-item warning" data-level="235">
                    <div class="level-value">+235 cm</div>
                    <div class="level-desc">Vand l√∏ber over kajkanten til lav P-plads (√òst)</div>
                </div>
                <div class="level-item warning" data-level="230">
                    <div class="level-value">+230 cm</div>
                    <div class="level-desc">Vand over kajkanten p√• forpladsen i Nordby</div>
                </div>
                <div class="level-item warning" data-level="200">
                    <div class="level-value">+200-225</div>
                    <div class="level-desc">Bilsejlads kan stoppes pga. h√∏j vandstand</div>
                </div>
            </div>
        </div>

        <!-- Low Water Levels -->
        <div class="card">
            <div class="card-header primary">
                Lavvande ‚Äî Begr√¶nsninger
            </div>
            <div id="lowWaterLevels">
                <div class="level-item low" data-level="-140">
                    <div class="level-value">‚àí140 cm</div>
                    <div class="level-desc">Busser og lave biler kan f√• bundkar-ber√∏ring</div>
                </div>
                <div class="level-item low" data-level="-152">
                    <div class="level-value">‚àí152 cm</div>
                    <div class="level-desc">Biloverf√∏rsel usikker; lastning efter v√¶gt og frih√∏jde</div>
                </div>
                <div class="level-item low" data-level="-172">
                    <div class="level-value">‚àí172 cm</div>
                    <div class="level-desc">Sejlads indstilles ‚Äì ca. 60 cm vand ved rampen</div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Reference: cm relativ til DVR90 ¬∑ Simuleret tidevandsmodel</p>
            <p>Semi-diurnal tidevand (12.42 timer) ¬∑ Amplitude: 165 cm</p>
            <p>‚ö†Ô∏è Simuleret data - Tjek altid officielle kilder f√∏r sejlads</p>
            <p><a href="https://www.dmi.dk/hav/vandstand/" target="_blank">DMI Vandstand ‚Üó</a> ¬∑ 
               <a href="https://www.fanoelinjen.dk/" target="_blank">Fan√∏linjen ‚Üó</a></p>
        </footer>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn primary" onclick="window.print()" title="Print">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9V2h12v7"/>
                <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/>
                <rect x="6" y="14" width="12" height="8"/>
            </svg>
        </button>
        <button class="action-btn" onclick="window.scrollTo(0,0)" title="Til top">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 15l-6-6-6 6"/>
            </svg>
        </button>
    </div>

    <script>
        // Tidal Model Configuration
        const TIDE_CONFIG = {
            cycle: 12.42,           // Semi-diurnal tide cycle in hours
            amplitude: 165,         // Typical amplitude for Esbjerg (cm)
            meanLevel: 0,           // Mean water level (DVR90)
            springTideBoost: 1.2,   // Spring tide multiplier
            neapTideReduction: 0.7, // Neap tide multiplier
            weatherVariation: 30    // Random weather effect range (cm)
        };

        // State
        let currentWaterLevel = 0;
        let tideData = [];
        let lastTrend = 'stable';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            generateTideData();
            updateDisplay();
            
            // Update every minute
            setInterval(() => {
                generateTideData();
                updateDisplay();
            }, 60000);
            
            // Add smooth animation every 5 seconds
            setInterval(() => {
                animateValueChange();
            }, 5000);
        });

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('da-DK', options);
        }

        // Generate realistic tide data
        function generateTideData() {
            const now = new Date();
            tideData = [];
            
            // Calculate moon phase for spring/neap tides
            const moonPhase = getMoonPhase(now);
            const tideFactor = moonPhase < 0.25 || moonPhase > 0.75 ? 
                TIDE_CONFIG.springTideBoost : TIDE_CONFIG.neapTideReduction;
            
            // Generate 48 hours of data
            for (let i = -24; i <= 24; i++) {
                const time = new Date(now.getTime() + i * 60 * 60 * 1000);
                const waterLevel = calculateWaterLevel(time, tideFactor);
                
                tideData.push({
                    time: time,
                    value: waterLevel
                });
            }
            
            // Current water level
            currentWaterLevel = calculateWaterLevel(now, tideFactor);
        }

        // Calculate water level at specific time
        function calculateWaterLevel(time, tideFactor) {
            const hour = time.getHours() + time.getMinutes() / 60;
            
            // Primary tidal component
            const tidePhase = (hour / TIDE_CONFIG.cycle) * 2 * Math.PI;
            const primaryTide = TIDE_CONFIG.amplitude * Math.sin(tidePhase) * tideFactor;
            
            // Secondary harmonic (M4 - shallow water effect)
            const secondaryTide = (TIDE_CONFIG.amplitude * 0.15) * 
                Math.sin(2 * tidePhase + Math.PI / 4);
            
            // Diurnal inequality
            const diurnalPhase = (hour / 24) * 2 * Math.PI;
            const diurnalEffect = (TIDE_CONFIG.amplitude * 0.1) * Math.sin(diurnalPhase);
            
            // Weather effect (slowly varying)
            const weatherSeed = Math.floor(time.getTime() / (1000 * 60 * 60 * 6));
            const weatherEffect = Math.sin(weatherSeed) * TIDE_CONFIG.weatherVariation;
            
            // Storm surge simulation (occasional)
            let stormSurge = 0;
            if (Math.sin(weatherSeed * 0.1) > 0.8) {
                stormSurge = Math.abs(Math.sin(weatherSeed * 0.2)) * 50;
            }
            
            return Math.round(
                TIDE_CONFIG.meanLevel + 
                primaryTide + 
                secondaryTide + 
                diurnalEffect + 
                weatherEffect + 
                stormSurge
            );
        }

        // Get moon phase (0 = new moon, 0.5 = full moon)
        function getMoonPhase(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            // Simple moon phase calculation
            const c = Math.floor(365.25 * year);
            const e = Math.floor(30.6 * month);
            const jd = c + e + day - 694039.09;
            const phase = (jd / 29.53059) % 1;
            
            return phase;
        }

        // Update display
        function updateDisplay() {
            // Update current value
            const currentValueEl = document.getElementById('currentValue');
            currentValueEl.textContent = formatWaterLevel(currentWaterLevel);
            currentValueEl.className = getValueClass(currentWaterLevel);
            
            // Update time
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                `Simuleret: ${now.toLocaleTimeString('da-DK', { hour: '2-digit', minute: '2-digit' })}`;
            document.getElementById('updateTime').textContent = 
                `Opdateret ${now.toLocaleTimeString('da-DK', { hour: '2-digit', minute: '2-digit' })}`;
            
            // Calculate trend
            const trend = calculateTrend();
            updateTrendDisplay(trend);
            
            // Find next high tide
            findNextHighTide();
            
            // Update status
            updateStatus();
            
            // Highlight active levels
            highlightActiveLevels();
        }

        // Calculate trend
        function calculateTrend() {
            const now = new Date();
            const futureTime = new Date(now.getTime() + 30 * 60 * 1000); // 30 min ahead
            const futureLevel = calculateWaterLevel(futureTime, 1);
            
            const diff = futureLevel - currentWaterLevel;
            
            if (Math.abs(diff) < 5) return 'stable';
            return diff > 0 ? 'rising' : 'falling';
        }

        // Update trend display
        function updateTrendDisplay(trend) {
            const trendEl = document.getElementById('trend');
            const textEl = document.getElementById('trendText');
            
            trendEl.className = `trend ${trend}`;
            lastTrend = trend;
            
            if (trend === 'rising') {
                textEl.textContent = 'Stigende';
                trendEl.querySelector('svg').innerHTML = '<path d="M7 17l9.2-9.2M17 17V7h-10"></path>';
            } else if (trend === 'falling') {
                textEl.textContent = 'Faldende';
                trendEl.querySelector('svg').innerHTML = '<path d="M7 7l9.2 9.2M7 7v10h10"></path>';
            } else {
                textEl.textContent = 'Stabil';
                trendEl.querySelector('svg').innerHTML = '<path d="M5 12h14"></path>';
            }
        }

        // Find next high tide
        function findNextHighTide() {
            const now = new Date();
            let highTide = null;
            
            // Look for peak in next 13 hours
            for (let i = 0; i < 13; i++) {
                const checkTime = new Date(now.getTime() + i * 60 * 60 * 1000);
                const level = calculateWaterLevel(checkTime, 1);
                
                if (!highTide || level > highTide.value) {
                    highTide = {
                        time: checkTime,
                        value: level
                    };
                }
            }
            
            // Refine to find actual peak
            if (highTide) {
                for (let m = -30; m <= 30; m += 5) {
                    const checkTime = new Date(highTide.time.getTime() + m * 60 * 1000);
                    const level = calculateWaterLevel(checkTime, 1);
                    
                    if (level > highTide.value) {
                        highTide = {
                            time: checkTime,
                            value: level
                        };
                    }
                }
            }
            
            // Update display
            if (highTide) {
                document.getElementById('nextHighValue').textContent = formatWaterLevel(highTide.value);
                document.getElementById('nextHighValue').className = getValueClass(highTide.value);
                
                document.getElementById('nextHighTime').textContent = 
                    highTide.time.toLocaleTimeString('da-DK', { hour: '2-digit', minute: '2-digit' });
                
                // Calculate time until high tide
                const minutesUntil = Math.round((highTide.time - now) / (1000 * 60));
                const hoursUntil = Math.floor(minutesUntil / 60);
                const minsUntil = minutesUntil % 60;
                
                document.getElementById('timeToHighText').textContent = 
                    `${hoursUntil}t ${minsUntil}m`;
            }
        }

        // Update status alert
        function updateStatus() {
            const alertEl = document.getElementById('statusAlert');
            const iconEl = document.getElementById('statusIcon');
            const titleEl = document.getElementById('statusTitle');
            const messageEl = document.getElementById('statusMessage');
            
            let status = 'safe';
            let title = 'Normal sejlads';
            let message = 'Vandstanden tillader normal drift af f√¶rgen.';
            
            if (currentWaterLevel >= 240 || currentWaterLevel <= -152) {
                status = 'danger';
                title = 'Sejlads truet';
                
                if (currentWaterLevel >= 240) {
                    message = `Meget h√∏j vandstand (${formatWaterLevel(currentWaterLevel)}). Sejlads kan blive indstillet.`;
                } else {
                    message = `Meget lav vandstand (${formatWaterLevel(currentWaterLevel)}). Biloverf√∏rsel usikker.`;
                }
            } else if (currentWaterLevel >= 200 || currentWaterLevel <= -140) {
                status = 'warning';
                title = 'Sejlads p√•virket';
                
                if (currentWaterLevel >= 200) {
                    message = `H√∏j vandstand (${formatWaterLevel(currentWaterLevel)}). Hold √∏je med udviklingen.`;
                } else {
                    message = `Lav vandstand (${formatWaterLevel(currentWaterLevel)}). V√¶r opm√¶rksom ved ilandk√∏rsel.`;
                }
            }
            
            // Update UI
            alertEl.className = `status-alert ${status}`;
            iconEl.className = `status-icon ${status}`;
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            // Update icon
            if (status === 'danger') {
                iconEl.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>';
            } else if (status === 'warning') {
                iconEl.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';
            } else {
                iconEl.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"></path></svg>';
            }
        }

        // Highlight active water levels
        function highlightActiveLevels() {
            document.querySelectorAll('.level-item').forEach(el => {
                el.classList.remove('active');
                
                const level = parseInt(el.dataset.level);
                if (!isNaN(level)) {
                    if (level > 0 && currentWaterLevel >= level - 10 && currentWaterLevel <= level + 10) {
                        el.classList.add('active');
                    }
                    if (level < 0 && currentWaterLevel <= level + 10 && currentWaterLevel >= level - 10) {
                        el.classList.add('active');
                    }
                }
            });
        }

        // Format water level
        function formatWaterLevel(value) {
            return `${value >= 0 ? '+' : ''}${value} cm`;
        }

        // Get value class based on water level
        function getValueClass(value) {
            if (value >= 240 || value <= -152) return 'value danger';
            if (value >= 200 || value <= -140) return 'value warning';
            if (value <= 0) return 'value low';
            return 'value normal';
        }

        // Animate value changes
        function animateValueChange() {
            const currentValueEl = document.getElementById('currentValue');
            const oldValue = currentWaterLevel;
            
            // Simulate small change
            const change = lastTrend === 'rising' ? Math.random() * 3 : 
                          lastTrend === 'falling' ? -Math.random() * 3 : 
                          (Math.random() - 0.5) * 2;
            
            currentWaterLevel = Math.round(currentWaterLevel + change);
            
            // Animate
            currentValueEl.style.transition = 'none';
            currentValueEl.style.transform = 'scale(1.05)';
            setTimeout(() => {
                currentValueEl.textContent = formatWaterLevel(currentWaterLevel);
                currentValueEl.style.transition = 'transform 0.3s ease';
                currentValueEl.style.transform = 'scale(1)';
            }, 100);
        }

        // PWA Support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,').catch(() => {});
        }
    </script>
</body>
</html>
